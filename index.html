<html>

<body>

    <h1>Welcome to Multimap!</h1>

    <table style="width:800">
        <tr align="center">
            <th>Colors</th>
            <th>Angle(integer)</th>
            <th>Angle(decimal)</th>
        </tr>
        <tr align="center">
            <td>
                <input type="range" min="1" max="360" value=1 class="slider" id="colorSlider">
            </td>
            <td>
                <input type="range" min="0" max="180" value="30" step="1" class="slider" id="angleSlider">
            </td>
            <td>
                <input type="range" min="0" max="1" value="0" step="0.001" class="slider" id="deltaSlider">
            </td>
        </tr>
        <tr align="center">
            <td>
                <textarea readonly name="colorsBox" id="colorsBox" cols="18" rows="1" style="font-size: 16px"></textarea>
            </td>
            <td>
                <textarea readonly name="angleBox" id="angleBox" cols="18" rows="1" style="font-size: 16px"></textarea>
            </td>
            <td>
                <textarea readonly name="deltaBox" id="deltaBox" cols="18" rows="1" style="font-size: 16px"></textarea>
            </td>
        </tr>
        <tr>
            <td colspan="3" align="center">
                <textarea readonly name="infoBos" id="infoBox" cols="35" style="font-size: 18px" rows="1"></textarea>
            </td>
        </tr>
    </table>

    <canvas id="myCanvas" style="border:1px solid #c3c3c3;">
        Your browser does not support the canvas element.
    </canvas>


    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>

    <script>
        var canvasDiv = document.getElementById("canvasContainer"),
            canvas = document.getElementById("myCanvas"),
            w = 800,
            h = 800,
            ctx = canvas.getContext("2d"),
            cSlider = document.getElementById("colorSlider"),
            aSlider = document.getElementById("angleSlider"),
            dSlider = document.getElementById("deltaSlider"),
            cOutput = document.getElementById("colorsBox"),
            aOutput = document.getElementById("angleBox"),
            dOutput = document.getElementById("deltaBox"),
            iOutput = document.getElementById("infoBox"),
            colorStr,
            colors,
            period,
            delta,
            angle,
            angleStr,
            deltaStr = 0,
            hue = "",
            r = 360,
            t = 0,
            i = 0,
            c = Math.PI / 180, // Degrees to radians conversion factor
            approxEqual = "&#8776", //Unicode for "approximately equal"
            degrees = "&#x00B0";

        canvas.width = w;
        canvas.height = h;
        cx = w / 2;
        cy = h / 2;

        function setParameters() {
            colorsStr = cSlider.value;
            colors = parseInt(colorsStr);
            cOutput.innerHTML = colorsStr;
            //        periodStr = pMenu.value;
            //        period = parseInt(periodStr);
            deltaStr = dSlider.value;
            delta = parseFloat(deltaStr);
            dOutput.innerHTML = deltaStr;
            angleStr = aSlider.value;
            angle = parseFloat(angleStr);
            theta = angle + delta;
            aOutput.innerHTML = (Math.round(theta * 1000) / 1000) + " " + degrees;
            cm = theta / 360; //Multiple of 360 that equals colors times angle
            if (isInteger(cm, .001)) {
                cMsg = (Math.round(cm) == 1 ? " &#8776 360&#x00B0" : " &#8776 360" + "&#x00B0" + " * " + Math.round(cm));
            } else {
                matrix = findFraction(theta / 360);
                if (matrix[2] == 0) {
                    roundCM = Math.round(cm * 100000) / 100000;
                    oneOverCM = Math.round(1000 / cm) / 1000;
                    cMsg = " " + approxEqual + " 360 X " + roundCM;
                } else {
                    cMsg = (Math.round(theta * 1000) / 1000) + (cm < 1 ? " " + approxEqual + " 360 * " + matrix[1] + "/" +
                    matrix[2] : " " + approxEqual + " 360 * (" + matrix[0] + " + " +
                    matrix[1] + "/" + matrix[2] + ")")
            }
        }
        iOutput.innerHTML = cMsg;
        }


        cSlider.oninput = function () {
            clearScreen();
            setParameters();
            r = 360;
            t = 0;
            i = 0;
            drawMap();
        }

        aSlider.oninput = function () {
            clearScreen();
            setParameters();
            r = 360;
            t = 0;
            i = 0;
            drawMap();
        }

        dSlider.oninput = function () {
            clearScreen();
            setParameters();
            r = 360;
            t = 0;
            i = 0;
            drawMap();
        }

        function drawMap() {
            while (r > 20) {
                dx = cx + r * Math.cos(c * t);
                dy = cy - r * Math.sin(c * t);
                hue = ((360 / colors) * i).toString();
                ctx.fillStyle = "hsl(" + hue + ", 100%, 50%)";
                ctx.fillRect(dx, dy, 3, 3);
                t += angle + delta;
                i++;
                r *= 0.9999;
            }
        }

        function clearScreen() {
            ctx.clearRect(0, 0, 800, 800);
        }

        function isInteger(num, tol) {
            return ((num - (Math.floor(num)) < tol) || (num - Math.floor(num + 2 * tol)) < tol)
        }

        function findFraction(n) {
            if (!isInteger(n)) {
                var fraction = [0, 0, 0];
                var intPart = Math.floor(n);
                var fracPart = n - intPart;
                for (var denominator = 2; denominator < 360; denominator++) {
                    var numerator = fracPart * denominator;
                    if (isInteger(numerator, 0.001)) {
                        fraction = [intPart, Math.round(numerator), denominator];
                        break;
                    } else {
                        fraction = [intPart, fracPart, 0];
                    }
                }
                return fraction;
            }
        }


        setParameters();
        drawMap();
    </script>

</body>

</html>